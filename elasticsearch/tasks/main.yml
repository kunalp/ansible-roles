---

- name: Install OpenJDK Java runtime
  apt: name=openjdk-7-jre update_cache=yes cache_valid_time=3600 state=present

- name: Download and install the Public Signing Key
  apt_key: url=http://packages.elasticsearch.org/GPG-KEY-elasticsearch state=present

- name: Add elasticsearch deb repository
  apt_repository: repo='deb http://packages.elasticsearch.org/elasticsearch/1.3/debian stable main' state=present

- name: Install elasticsearch
  apt: name=elasticsearch update_cache=yes state=present
  notify:
    - elasticsearch-start

- name: write elasticsearch.yml
  action: template src=elasticsearch.yml dest=/etc/elasticsearch/elasticsearch.yml
  notify:
    - elasticsearch-restart

- name: write logging.yml
  action: template src=logging.yml dest=/etc/elasticsearch/logging.yml
  notify:
    - elasticsearch-restart

- name: Ensure elasticsearch starts on boot up
  command: sudo update-rc.d elasticsearch defaults 95 10
  args:
    creates: /etc/rc0.d/K10elasticsearch
